var controllers=angular.module("dewyControllers",[]);controllers.controller("appController",["$scope","$location","authService",function(a,b,c){a.signOff=function(){c.signOff()}}]),controllers.controller("filterController",["$scope","filterFactory","operators","fields","filters","currentFilter","tags",function(a,b,c,d,e,f,g){a.addRule=function(b,c){function d(c){var f,g=c.rules;if(g)for(f=g.length;f--;){if(g[f]==b)return a.currentFilter.count++,g[f].rules?g[f].rules.splice(0,0,e):g.splice(f+1,0,e);d(g[f])}}var e;e=c?{operator:"any",rules:[{field:"Base URL",choice:"contains"}]}:{field:"Base URL",choice:"contains"},d(a.currentFilter)},a.cancel=function(){window.history.back()},a.deleteFilter=function(){b["delete"](a.currentFilter.fid).then(function(a){window.history.back()})},a.deleteRule=function(b){function c(d){var e,f=d.rules;if(f){if(e=f.length,!e)return"empty";for(;e--;){if(f[e]==b){var g=f.splice(e,1);if(g[0].rules)for(var h=g[0].rules.length;h--;)f.splice(e,0,g[0].rules[h]);else a.currentFilter.count--;if(!f.length)return"empty";return}"empty"==c(f[e])&&a.deleteRule(f[e])}}}c(a.currentFilter)},a.getChoices=function(b){for(var c=0;c<a.fields.length;c++)if(a.fields[c].title==b)return a.fields[c].choices},a.getDetails=function(b){for(var c=0;c<a.fields.length;c++)if(a.fields[c].title==b)return a.fields[c].details},a.saveFilter=function(){a.filterForm.$valid&&(a.currentFilter.fid?b.update(a.currentFilter):b.create(a.currentFilter))},a.updateChoice=function(b,c){choices=a.getChoices(b.field),-1==choices.indexOf(b.choice)&&(b.choice=choices[0]),details=a.getDetails(b.field),details&&-1==details.indexOf(b.choice)&&(b.detail=details[0]);for(var d=0;d<a.fields.length;d++)a.fields[d].title==b.field&&(field=a.fields[d]);for(var d=0;d<a.fields.length;d++)a.fields[d].title==c&&(oldField=a.fields[d]);field.value!=oldField.value&&("tag"==field.value?b.value=a.tags[0]:"integer"==field.value?b.value=0:b.value=null)},a.updateNotifications=function(b){b||(a.currentFilter.notifications.appears.enabled=a.currentFilter.notifications.disappears.enabled=a.currentFilter.notifications.total.enabled=!1)},a.valueIsType=function(b,c){for(var d=0;d<a.fields.length;d++)if(a.fields[d].title==b)return a.fields[d].value==c?!0:!1},a.operators=c,a.fields=d,a.filters=e,a.currentFilter=f,a.tags=g,a.notificationsOn=f.notifications.appears.enabled||f.notifications.disappears.enabled||f.notifications.total.enabled?!0:!1,a.notificationChoices=["is","is not","is greater than","is less than","is greater than or equal to","is less than or equal to"],a.sortableOptions={connectWith:".rule-group",handle:".handle",helper:"clone",opacity:.75,placeholder:"rule-group-placeholder",stop:function(b,c){a.deleteRule(null)}}}]),controllers.controller("manageController",["$scope","sites","user","sitesFactory","userFactory",function(a,b,c,d,e){a.auditSite=function(a){return d.audit(a).error(function(a,b){console.log(a)}).success(function(a){console.log(a)})},a.getKey=function(){a.apikey=c.apikey},a.deleteSite=function(b){for(i=a.sites.length;i--;)if(a.sites[i].sid==b){a.sites.splice(i,1)}d["delete"](b)},a.resetKey=function(b){e.resetKey(b).then(function(b){a.apikey=b})},a.sites=b,a.apikey=c.apikey}]),controllers.controller("signonController",["authService","$scope","$http",function(a,b,c){b.submit=function(){if(b.form.$valid){b.message=null;var d="http://dewy.io/auth/signon";c.post(d,{username:b.username,password:b.password,remember:b.remember}).success(function(c){a.signOn(c,b.remember)}).error(function(a,c){"400"==c?b.message="Your username and password combination is incorrect, please try again.":b.message="Dewy could not authenticate at this time."})}}}]),controllers.controller("signupController",["authService","$scope","$http",function(a,b,c){b.submit=function(){if(b.form.$valid){b.message=null;var d="http://dewy.io/auth/signup";c.post(d,{username:b.username,email:b.email,password:b.password}).success(function(b){a.signOn(b)}).error(function(a,c){"400"!=c?b.message="Dewy could not sign you up at this time.":b.error=a})}}}]),controllers.controller("sitesController",["$scope","$location","sitesFactory","filters","currentFilter",function(a,b,c,d,e){a.changeView=function(b){a.$emit("viewChange",b),sessionStorage.view=JSON.stringify(b)},a.openFolder=function(b){a.folders[b]=!a.folders[b],sessionStorage.folders=JSON.stringify(a.folders)},a.currentFilter=e,"/sites"==b.path()||a.currentFilter.url||b.path("sites"),a.$on("viewChange",function(b,d){"overview"==d?e?c.getAll(e.fid).then(function(b){a.sites=b,a.viewPage="templates/sites_overview.html"}):c.getAll().then(function(b){a.sites=b,a.viewPage="templates/sites_overview.html"}):"modules"==d?a.viewPage="templates/sites_modules.html":"users"==d?a.viewPage="templates/sites_users.html":"content"==d&&(a.viewPage="templates/sites_content.html"),a.view=d}),sessionStorage.folders?a.folders=JSON.parse(sessionStorage.folders):a.folders={},sessionStorage.view?a.$emit("viewChange",JSON.parse(sessionStorage.view)):a.$emit("viewChange","overview"),a.filters=d}]),controllers.controller("sitesOverviewController",["$scope","sitesFactory",function(a,b){a.addTags=function(c){var d="tagForm"+c;if(this[d].$valid){for(tags=this.tags.split(","),i=0;i<tags.length;i++)tag=tags[i].trim(),a.sites[c].tags||(a.sites[c].tags=[]),""!=tag&&-1==a.sites[c].tags.indexOf(tag)&&(a.sites[c].tags.push(tag),console.log(a.sites[c].tags));b.setTags(a.sites[c]),this.tags=null,this[d].$setPristine(),this[d].tags.$setUntouched()}},a.changeSorting=function(b){var c=a.sort;c.column==b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.deleteTag=function(c,d){a.sites[d].tags.splice(c,1),b.setTags(a.sites[d])},a.getNumber=function(a){return new Array(Math.round(a))},a.openDetails=function(c,d){a.openSite&&a.openSite.sid==a.sites[c].sid&&a.openSite.detail==d?a.openSite=null:"details"in a.sites[c]?a.openSite={sid:a.sites[c].sid,tags:a.sites[c].tags,details:a.sites[c].details,detail:d}:b.get(a.sites[c].sid).then(function(b){a.sites[c].details=b,a.openSite={sid:a.sites[c].sid,tags:a.sites[c].tags,details:a.sites[c].details,detail:d}})},a.sort={column:"title",descending:!1}}]),controllers.controller("userController",["$scope",function(a){a.cancel=function(){window.history.back()}}]);
//# sourceMappingURL=controllers.js.map